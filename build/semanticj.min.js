/*! semanticj 0.1.0 2016-03-11 */
function BreakdownBy(a){this.breakdownAttribute=a,this.size=0,this.popLookup={},this.pops=[],this.keys=[]}function Individual(a,b){if(this.uri=a,this.attributes={},"undefined"==typeof b&&(b=a),b)if(b.attributes)this.attributes=b.attributes;else for(var c in b)"string"==typeof c&&(this.attributes[c]=b[c])}function Population(a){if(this.individuals={},this.attributes={},this.size=0,this.first=void 0,this.last=void 0,"object"==typeof a)if("function"==typeof a.getIndividuals)for(var b in a.individuals)this.addIndividual(a.individuals[b]);else this.mergeIn(a)}function Filters(a){return this.filters={},this.filterCounts={},this.totalCount=0,"object"==typeof a&&jQuery.extend(this,a),this}function getOrderedKeys(a,b){var c,d=[],e=[];if(void 0!==b)for(c=0;c<b.length;c++)void 0!==a[b[c]]&&d.push(b[c]);for(c in a)a.hasOwnProperty(c)&&(void 0!==b?jQuery.inArray(c,d)<0&&e.push(c):e.push(c));return d.concat(e.sort())}function getOrderedArray(a,b,c){var d,e=[],f=[];if("function"==typeof c&&a.sort(c),void 0!==b)for(d=0;d<b.length;d++)jQuery.inArray(b[d],a)>=0&&e.push(b[d]);for(d=0;d<a.length;d++)void 0!==b?jQuery.inArray(a[d],e)<0&&f.push(a[d]):f.push(d);return e.concat(f.sort())}function roundNumber(a,b,c){b="undefined"!=typeof b?b:2;var d=Math.round(a*Math.pow(10,b))/Math.pow(10,b);if(c&&(d=d.toString(),b>0))for(d.indexOf(".")<0&&(d+=".");d.length-d.indexOf(".")<=b;)d+="0";return d}function getNumberPrefix(a){return"Dollar"===a.attribute(":hasDataType")?"$":""}function getNumberSuffix(a){return"Percent"===a.attribute(":hasDataType")?"%":"Dollar"===a.attribute(":hasDataType")&&a.attribute(":hasDisplayLabel")?a.attribute(":hasDisplayLabel"):""}function getNumberValue(a,b,c){var d=a.attribute(b);return"Percent"===a.attribute(":hasDataType")?roundNumber(100*d,a.attribute(":hasDataPrecision"),c):roundNumber(d,a.attribute(":hasDataPrecision"),c)}function getNumberFormatted(a,b,c){var d=getNumberValue(a,b,c);return isNaN(d)?"n/a":getNumberPrefix(a)+addCommas(d)+getNumberSuffix(a)}function addCommas(a){if("number"==typeof a&&(a=a.toString()),"string"==typeof a)if(a.indexOf(".")<0)a=a.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");else{var b=a.split(".");a=b[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"."+b[1]}return a}BreakdownBy.prototype.getSize=function(){return this.size},BreakdownBy.prototype.getBreakdownAttribute=function(){return this.breakdownAttribute},BreakdownBy.prototype.get=function(a,b){return b&&!this.popLookup.hasOwnProperty(a)&&(this.size++,this.pops.push(this.popLookup[a]=new Population),this.keys.push(a)),this.popLookup[a]},BreakdownBy.prototype.getKeys=function(){return this.keys},BreakdownBy.prototype.getPops=function(){return this.pops},BreakdownBy.prototype.getOrderedKeys=function(a){if(void 0!==a){var b,c=[],d=[];for(b=0;b<a.length;b++)void 0!==this.popLookup[a[b]]&&c.push(a[b]);for(b=0;b<this.keys.length;b++)void 0!==a?jQuery.inArray(this.keys[b],c)<0&&d.push(this.keys[b]):d.push(this.keys[b]);return c.concat(d.sort())}return this.keys.slice(0).sort()},BreakdownBy.prototype.getPopSizes=function(){for(var a={},b=0;b<this.pops.length;b++)a[this.keys[b]]=this.pops[b].getSize();return a};var BreakdownBy=require("BreakdownBy.js");"undefined"==typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.length>0&&this.charAt(0)===a}),"undefined"==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)}),Individual.prototype.getAttributes=function(){return this.attributes},Individual.prototype.attribute=function(a,b){if("undefined"!=typeof b)this.attributes[a]=b;else if(a&&!this.attributes[a]&&a.startsWith(":"))for(var c in this.attributes)if(c.endsWith(a))return this.attributes[c];return this.attributes[a]},Individual.prototype.getURI=function(){return this.uri},Population.prototype.addIndividual=function(a){var b,c,d;a instanceof Individual?b=a.getURI():(b="_id_"+this.size,a=new Individual(b,a)),this.individuals[b]||(this.size++,this.last=b,this.first||(this.first=b)),this.individuals[b]=a;for(c in a.getAttributes())d=a.attribute(c),"string"==typeof d&&(void 0===this.attributes[c]&&(this.attributes[c]={}),void 0===this.attributes[c][d]?this.attributes[c][d]=1:this.attributes[c][d]++);for(c in this.attributes)void 0===a.attribute(c)&&(this.attributes[c][""]=0);return a},Population.prototype.mergeIn=function(a){if(a.individuals)for(var b in a.individuals)"string"==typeof b&&this.addIndividual(a.get(b));else if(Array.isArray(a))for(var c in a)this.addIndividual(a[c])},Population.prototype.get=function(a){var b=this.individuals[a];if(b)return b;if(a.startsWith("#")||a.startsWith(":"))for(var c in this.individuals)if("string"==typeof c&&c.endsWith(a))return this.individuals[c];return null},Population.prototype.getSize=function(){return this.size},Population.prototype.hasIndividuals=function(){return this.size>0},Population.prototype.getIndividuals=function(){return this.individuals},Population.prototype.getFirst=function(){return this.hasIndividuals()?this.get(this.first):void 0},Population.prototype.getLast=function(){return this.hasIndividuals()?this.get(this.last):void 0},Population.prototype.getAttributes=function(a){if("string"==typeof a){if(this.attributes[a])return this.attributes[a];if(a.startsWith("#")||a.startsWith(":"))for(var b in this.attributes)if("string"==typeof b&&b.endsWith(a))return this.attributes[b]}return{}},Population.prototype.getAttributeValues=function(a){var b=[];if("string"==typeof a){var c=this.getAttributes(a);if("object"==typeof c)for(var d in c)b.push(d)}return b},Population.prototype.filter=function(a,b){var c,d=new Population;if(a instanceof Filters)c=a;else{if("string"!=typeof a||"string"!=typeof b)throw"You must either pass a Filters object or a (string) Property and Value to Popoulation.filter()";c=new Filters,c.addFilter(a,b)}for(var e in this.getIndividuals()){var f=this.get(e);c.isIndividualVisible(f)&&d.addIndividual(f)}return d},Population.prototype.breakdownBy=function(a){var b,c,d=new BreakdownBy(a);if("string"==typeof a)for(c in this.getIndividuals())b=this.get(c).attribute(a),"undefined"==typeof b&&(b=""),d.get(b,!0).addIndividual(this.get(c));return d},Population.prototype.getAverage=function(a,b){var c,d=[];for(var e in this.getIndividuals()){if(c=this.get(e).attribute(a),"undefined"==typeof c){if(!b)continue;c=""}d.push(c)}if(0!==d.length){for(var f=0,g=0;g<d.length;g++)if(d[g]&&""!==d[g])try{f+=parseFloat(d[g])}catch(h){console.log("The value '"+d[g]+"' for attribute '"+a+"' could not be parsed as a number to calculate the average: "+h)}return f/d.length}},Population.prototype.getMedian=function(a){var b,c=[];for(var d in this.getIndividuals())if(b=this.get(d).attribute(a),"undefined"!=typeof b)try{c.push(parseFloat(b))}catch(e){console.log("The values '"+b+"' for attribute '"+a+"' on individual '"+d+"' could not be parsed as a number to calculate the median: "+e)}if(0!==c.length){if(1===c.length)return c[0];if(c.sort(function(a,b){return a-b}),c.length%2===0){var f=c.length/2;return(c[f]+c[f-1])/2}return parseFloat(c[Math.floor(c.length/2)])}},Population.prototype.getSum=function(a){var b,c=0;for(var d in this.getIndividuals())if(b=this.get(d).attribute(a),b&&""!==b)try{c+=parseFloat(b)}catch(e){console.log("The value '"+b+"' for attribute '"+a+"' could not be parsed as a number to calculate the sum: "+e)}return c},Population.prototype.getMax=function(a){var b,c=void 0;for(var d in this.getIndividuals())if(b=this.get(d).attribute(a),b&&""!==b)try{b=parseFloat(b),(!c||b>c)&&(c=b)}catch(e){console.log("The value '"+b+"' for attribute '"+a+"' could not be parsed as a number to calculate the max: "+e)}return c},Population.prototype.getMin=function(a){var b,c=void 0;for(var d in this.getIndividuals())if(b=this.get(d).attribute(a),b&&""!==b)try{b=parseFloat(b),(!c||c>b)&&(c=b)}catch(e){console.log("The value '"+b+"' for attribute '"+a+"' could not be parsed as a number to calculate the min: "+e)}return c},Filters.prototype.reset=function(){return this.filters={},this.filterCounts={},this.totalCount=0,this},Filters.prototype.getFilters=function(){return this.filters},Filters.prototype.getFilterValues=function(a){var b=[];if(this.hasFilter(a))for(var c in this.filters[a])b.push(c);return b},Filters.prototype.hasFilters=function(){return this.totalCount>0},Filters.prototype.hasFilter=function(a,b){return void 0===b?void 0!==this.filters[a]&&this.filterCounts[a]>0:void 0!==this.filters[a]&&this.filters[a][b]===!0},Filters.prototype.addFilter=function(a,b){if("undefined"==typeof a)return!1;if(void 0===this.filters[a]&&(this.filters[a]={},this.filterCounts[a]=0),"object"==typeof b)for(var c in b)this.filters[a][c]!==!0&&(this.filters[a][c]=!0,this.filterCounts[a]++,this.totalCount++);else this.filters[a][b]!==!0&&(this.filters[a][b]=!0,this.filterCounts[a]++,this.totalCount++);return this},Filters.prototype.removeFilter=function(a,b){if(a&&void 0!==this.filters[a])if("undefined"==typeof b)for(var c in this.filters[a])this.removeFilter(a,c);else void 0!==this.filters[a][b]&&(delete this.filters[a][b],this.filterCounts[a]--,this.totalCount--,0===this.filterCounts[a]&&(delete this.filters[a],delete this.filterCounts[a]));return this},Filters.prototype.isIndividualVisible=function(a){for(var b in this.filters){var c=a.attribute(b);void 0===c&&(c="");var d=this.filters[b][c];if(d!==!0)return!1}return!0},function($){if("undefined"==typeof $.fn.ontology){$.fn.ontology=function(a){try{methods[a]?methods[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?(console.error("Method "+a+' does not exist within "jQuery().ontology" namespace.'),$.error("Method "+a+' does not exist within "jQuery().ontology" namespace.')):methods.init.apply(this,arguments)}catch(b){console.error(b)}return this};var methods={init:function(a){return this.each(function(){var b=$(this),c=b.data("options");c||(b.data("options",$.extend(!0,{filters:new Filters,cache:{}},$.fn.ontology.defaults)),b.ontology("extendOptions",a),b.data("filteredPopulation",new Population),b.addClass("ontologyRoot"))})},load:function(a,b,c){return this.each(function(){var d=$(this);console.log("["+d.prop("id")+"] load: "+a+"  |  resetBeforeLoad: "+b+"  |  clearCache:"+c);var e=d.data("options");if(b&&d.ontology("reset",!1,c),"loaded"===e.status[a]&&e.cache[a])d.ontology("ontologyCallback",e.cache[a],"",a,{});else if("pending"!==e.status[a]){e.status[a]="pending";var f=d;$.ajax({type:"GET",url:a,success:function(b,c,d){f.ontology("ontologyCallback",b,c,a,d)},error:function(b,c,d){f.ontology("ontologyCallbackError",d,c,a,b)}})}})},reset:function(a,b){return this.each(function(){var c=$(this);console.log("["+c.prop("id")+"] reset: updateFilteredPopulation: "+a+"  |  clearCache: "+b);var d=c.data("options");c.removeData("population"),c.removeData("filteredPopulation"),d.filters.reset(),b&&(d.cache={},d.status={}),a&&c.ontology("updateFilteredIndividuals")})},extendOptions:function(a){return this.each(function(){var b=$(this);"object"==typeof a&&$.extend(b.data("options"),a)})},ontologyCallback:function(data,textStatus,ontURL,jqXHR){return this.each(function(){var jThis=$(this),options=jThis.data("options");options.status[ontURL]="loaded",options.cache[ontURL]=data;var population=jThis.data("population");population||(population=new Population,jThis.data("population",population));var incomingOnt=eval("("+data+")");for(var i in incomingOnt.individuals)population.addIndividual(incomingOnt.individuals[i]);for(var s in options.status)if("pending"===options.status[s])return;jThis.ontology("updateFilteredIndividuals"),"function"==typeof options.onloadCallback&&options.onloadCallback.call(jThis,population,options)})},ontologyCallbackError:function(a,b,c,d){return this.each(function(){var d=$(this),e=d.data("options");e.status[c]="error",alert("Error retriving '"+c+"' ontology.\n"+a+"\n"+b),d.ontology("updateFilteredIndividuals")})},addPopulation:function(a){return this.each(function(){var b=$(this),c=b.data("options"),d=b.data("population");d||(d=new Population,b.data("population",d)),d.mergeIn(a);for(var e in c.status)if("pending"===c.status[e])return;b.ontology("updateFilteredIndividuals"),"function"==typeof c.onloadCallback&&c.onloadCallback.call(b,d,c)})},updateFilteredIndividuals:function(){return this.each(function(){var a=$(this),b=a.data("options"),c=a.data("population");if(c){var d=c.filter(b.filters);a.data("filteredPopulation",d),"function"==typeof b.onpopulationChangeCallback&&b.onpopulationChangeCallback.call(a,d,b)}})},addFilter:function(a,b,c){return a?this.each(function(){var d=$(this),e=d.data("options");e.filters.addFilter(a,b),c&&d.ontology("updateFilteredIndividuals")}):this},setFilters:function(a,b){return"object"!=typeof a&&"Filter"!==a.constructor?this:this.each(function(){var c=$(this),d=c.data("options");d.filters=a,b&&c.ontology("updateFilteredIndividuals")})},removeFilter:function(a,b,c){return this.each(function(){var d=$(this),e=d.data("options");e.filters.removeFilter(a,b),c&&d.ontology("updateFilteredIndividuals")})},removeAllFilters:function(a){return this.each(function(){var b=$(this);b.data("options").filters.reset(),a&&b.ontology("updateFilteredIndividuals")})},debug:function(a){return this.each(function(){var b=$(this),c=(b.data("options"),$(a));0===c.length&&(c=b.find(".debug:first"),0===c.length&&(b.append("<div class='debug'></div>"),c=b.find(".debug:first"))),c.empty();var d="<div>",e=b.data("population");d+="<h3>Matched Count: "+e.getSize()+"</h3>";for(var f in e.getIndividuals()){var g=e.get(f);d+="<table class='individual'>",d+="<tr><th colspan='2' style='overflow:ellipsis;'>"+f+"</th></tr>";for(var h in g.getAttributes())d+="<tr><td class='attributeLabel'>"+h+"</td><td>"+g.attribute(h)+"</td></tr>";d+="</table>"}d+="</div>",c.append(d),c.show()})}};$.fn.ontology.defaults={onloadCallback:void 0,onpopulationChangeCallback:void 0,status:{},colorLookup:{"":""},defaultColors:["#94D6CE","#087B7B","#94D639","#527B10","#94D6E7","#0084A5","#6373B5","#082984","#B552AD","#730063","#FF9473","#AD0000","#FFB573","#AD4A18","#D6C610","#635208","#7BC66B","#186321","#9C7BBD","#29006B"],defaultColorIndex:0},$.fn.ontology.util={getColumnColor:function(a,b,c){return void 0!==a.colorLookup[b]&&""!==a.colorLookup[b]?a.colorLookup[b]:void 0!==a.colorLookup[c]&&""!==a.colorLookup[c]?a.colorLookup[c]:(a.defaultColors.length<=a.defaultColorIndex&&(a.defaultColorIndex=0),a.defaultColors[a.defaultColorIndex++])}}}}(jQuery);